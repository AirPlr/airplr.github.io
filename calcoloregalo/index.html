<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Calcolatore Regali</title>
  <style>
    body{font-family:Segoe UI, Tahoma, Geneva, Verdana, sans-serif;max-width:820px;margin:40px auto;padding:0 20px;color:#222}
    label{display:block;margin-top:12px}
    .row{display:flex;gap:12px;align-items:center}
    input[type=number], select{padding:8px;border:1px solid #ccc;border-radius:6px}
    button{margin-top:16px;padding:10px 14px;border:none;background:#0078d4;color:#fff;border-radius:6px;cursor:pointer}
    .result{margin-top:18px;font-weight:700;font-size:1.2rem}
    .hint{color:#555;font-size:0.9rem}
    .note{margin-top:14px;padding:10px;background:#f3f3f3;border-left:4px solid #ddd}
  </style>
</head>
<body>
  <h1>Calcolatore Regali</h1>


  <label>Numero Bambini (B)
    <input id="B" type="number" min="0" value="0">
  </label>

  <label>Numero Adulti (I)
    <input id="I" type="number" min="0" value="0">
  </label>

  <label>Costo del ristorante per persona (C)
    <input id="C" type="number" min="0" step="0.01" value="0">
  </label>

  <label>Grado di Parentela (P)
    <select id="P">
      <option value="1.5">-- Fratello/Sorella --</option>
      <option value="2.0">-- Genitore --</option>
      <option value="1.8">-- Nonno/Nonna --</option>
      <option value="1.5">-- Zio/Zia --</option>
      <option value="1.2">-- Cugino/Cugina --</option>
      <option value="1.0">-- Amico --</option>
    </select>
  </label>

  <label>Grado di 'Bella Figura' (D)
    <select id="D">
      <option value="1.5">-- Massimo --</option>
      <option value="1.3">-- Medio --</option>
      <option value="1.2">-- Sufficiente --</option>
      <option value="1.0">-- Normale --</option>
    </select>
  </label>

  <label>Numero Eventi (M)
    <input id="M" type="number" min="1" value="1">
  </label>

  <div class="row">
    <button id="calc">Calcola</button>
    <button id="reset" type="button">Reset</button>
  </div>

  <div class="result" id="result">Risultato: —</div>


  <script>
    // Replica della funzione Python calcolo(B,I,C,P,D,M)
    function calcolo(B,I,C,P,D,M){
      // assicurarsi che i numeri siano numerici
      B = Number(B);
      I = Number(I);
      C = Number(C);
      P = Number(P);
      D = Number(D);
      M = Number(M);

      let euro;
      if (M === 1){
        euro = (B/2 + I) * (C + (C * 0.3)) * P * D;
      } else {
        euro = (B/2 + I) * (C + (C * 0.3)) * P * D * (1 + (M - 1) * 0.5);
      }

      // modulo 50 e arrotondamento verso l'alto al multiplo di 50 successivo se necessario
        const approx = euro % 50;
        if (approx){
          const ecc = 50 - approx;
          euro = euro + ecc;
        }

      return euro;
    }

    const $ = id => document.getElementById(id);
    function showResult(text){
      $('result').textContent = 'Risultato: ' + text;
    }

    // Se P è una delle voci "sensibili", forziamo D a minimo 1.2
    const sensitiveP = new Set(["1.5","2.0","1.8","1.5"]);

    function enforceDMinima(){
      const pVal = $('P').value;
      const dEl = $('D');
      if (sensitiveP.has(pVal)){
        // se D è vuoto o inferiore a 1.2, impostalo a 1.2
        const currentD = dEl.value ? Number(dEl.value) : 0;
        if (currentD < 1.2){
          // prova a selezionare un option esistente con valore >=1.2, altrimenti imposta valore temporaneo
          let found = false;
          for (let i=0;i<dEl.options.length;i++){
            const v = Number(dEl.options[i].value);
            if (!isNaN(v) && v >= 1.2){ dEl.selectedIndex = i; found = true; break; }
          }
          if (!found){
            // nessuna option >=1.2, creiamo una option temporanea e la selezioniamo
            const opt = document.createElement('option');
            opt.value = '1.2';
            opt.text = '-- Forzato 1.2 --';
            opt.dataset.temp = '1';
            dEl.appendChild(opt);
            dEl.selectedIndex = dEl.options.length-1;
          }
          showResult('Grado di "Bella Figura" forzato a 1.2 per questa parentela.');
        }
      } else {
        // se in precedenza abbiamo creato un option temporaneo, rimuovilo
        for (let i=dEl.options.length-1;i>=0;i--){
          const o = dEl.options[i];
          if (o.dataset && o.dataset.temp === '1') o.remove();
        }
      }
    }

    function readAndCompute(){
      const B = $('B').value;
      const I = $('I').value;
      const C = $('C').value;
      const P = $('P').value;
      const D = $('D').value;
      const M = $('M').value || 1;

      // enforce minima prima del calcolo
      enforceDMinima();

      if (P === '' || D === ''){
        showResult('Seleziona un valore per P e D (le select sono vuote).');
        return;
      }

      const euro = calcolo(B,I,C,P,D,M);
      // se è intero mostriamo senza decimali, altrimenti con 2 decimali
      const display = Number.isInteger(euro) ? '€' + euro : '€' + euro.toFixed(2);
      showResult(display);
    }

    $('calc').addEventListener('click', readAndCompute);
    $('reset').addEventListener('click', ()=>{
      $('B').value = 0; $('I').value = 0; $('C').value = 0; $('P').selectedIndex = 0; $('D').selectedIndex = 0; $('M').value = 1; showResult('—');
    });

    // ricalcola al cambio degli input (opzionale)
    ['B','I','C','P','D','M'].forEach(id => {
      $(id).addEventListener('change', ()=>{
        // non forzare il calcolo se P o D non selezionati
        if ($('P').value === '' || $('D').value === '') return;
        readAndCompute();
      });
    });
  </script>
</body>
</html>
